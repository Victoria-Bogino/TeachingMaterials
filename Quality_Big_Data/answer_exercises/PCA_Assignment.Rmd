---
title: "Musk Data PCA Report"
author: "Deroshan Padotan"
date: "10 October 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

###Truncated SVD

 The R package used to perform the truncated single value decomposition (SVD) on the musk data set was the irlba package described [here](https://cran.r-project.org/web/packages/irlba/irlba.pdf) 

###PCA Code

**Note:** Before running the code below, the following packages must be installed

  * irlba
  * microbenchmark
  * ggplot2

R code for performing PCA using the irlba truncated SVD
```{r PCA_Code, message=FALSE}

#Musk PCA Function
Musk_PCA <- function(x, u, ex_col){
  
  ##Function parameters:
  #x: Matrix containing original data
  #u: left singular vector
  #ex_col: Index of column to be excluded during PCA analysis
  
  #Applying the left singular vector to the original data 
  pca.out <- x[, -ex_col] %*% u;
  
  return(pca.out)
  
}

#Setting variables
m.filepath <- "C:/Users/dpado/Documents/Data Visualization/Assignment 2/musk.txt"
musk.col <- 167

#Reading musk data from txt file into a matrix
m.data <- as.matrix(read.table(m.filepath, header=TRUE))

#Scaling and centering the data
m.scaled.data <- scale(m.data)

#Performing truncated singular value decomposition using the 
#irlba package (excluding the musk data column)
library(irlba)
m.trunc_svd <- irlba(t(m.scaled.data[, -musk.col]))

#Storing the left singular vector as a matrix
us <- as.matrix(m.trunc_svd$u)

pca.data <- Musk_PCA(m.data, us, musk.col)
```

###Principal Component Calculation Comparison with prcomp
```{r [prcomp_compare]}
##Comparing output with prcomp function

#Calculating principal components using prcomp
musk.pr <- prcomp(m.data[,-musk.col], center = TRUE, scale. = TRUE) 

#PC1 Comparison
max(abs(musk.pr$x[,1]) - abs(m.trunc_svd$d[1]*m.trunc_svd$v[,1]))

#PC2 Comparison
max(abs(musk.pr$x[,2]) - abs(m.trunc_svd$d[2]*m.trunc_svd$v[,2]))
```
By comparing the first two principal components generated by the truncated SVD method to those generated by the prcomp function as shown above we can see that there is a negligible difference between them indicating the functions are producing the same result

###Plotting PCA Data
```{r PCA_Plot, echo=FALSE}

plot(pca.data, pch=20, main = "Musk Molecule PCA Plot", xlab = "PC1", ylab = "PC2", col = m.data[, 167]+3)
legend("bottomleft", c("Non-Musk", "Musk"), pch=20, col = c(3, 4))
```


###SVD Function Speed Comparison

Plotting the comparison in speed of the normal SVD vs the irlba truncated SVD we can see that the truncated SVD is clearly faster
```{r svd_speed_compare, message=FALSE}
##Comparing speed of truncated SVD vs Normal SVD
library(microbenchmark)
library(ggplot2)
tm <- microbenchmark(svd(t(m.data[,-musk.col])), irlba(t(m.scaled.data[, -musk.col])), times=200L)
autoplot.microbenchmark(tm)
```

```{r Session_info}
sessionInfo()
```